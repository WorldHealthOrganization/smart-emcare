{
  "resourceType": "Questionnaire",
  "id": "emcarea.registration.p",
  "meta": {
    "profile": [
      "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire"
    ]
  },
  "extension": [
    {
      "url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",
      "valueCode": "shareable"
    },
    {
      "url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",
      "valueCode": "computable"
    },
    {
      "url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeCapability",
      "valueCode": "publishable"
    },
    {
      "url": "http://hl7.org/fhir/uv/cpg/StructureDefinition/cpg-knowledgeRepresentationLevel",
      "valueCode": "structured"
    },
    {
      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-targetStructureMap",
      "valueCanonical": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p"
    }
  ],
  "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Questionnaire/emcarea.registration.p",
  "title": "EmCareA.Registration.P",
  "status": "active",
  "experimental": false,
  "subjectType": [
    "Patient"
  ],
  "item": [
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "now()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "timestamp",
      "type": "dateTime",
      "required": false
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "iif(%resource.repeat(item).where(linkId='EmCare.A.DE01').answer.value.answer.value not empty,%resource.repeat(item).where(linkId='EmCare.A.DE01').answer.value.answer.value,%resource.repeat(item).where(linkId='EmCare.A.DE02').answer.value)"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "emcarepatientid",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%parent.encounter.id"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "emcareencounterid",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "uuid()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "emcarecommunicationrequesterid",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE03').answer.value != {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE01",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Unique identification",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE03').answer.value.value = true"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "uuid()"
          }
        }
      ],
      "linkId": "EmCare.A.DE02",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Unique identification",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "system": "http://hl7.org/fhir/questionnaire-item-control",
                "code": "check-box",
                "display": "Check-box"
              }
            ],
            "text": "Check-box"
          }
        }
      ],
      "linkId": "EmCare.A.DE03",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Child's Identity unknown/prefer to remain anonymous",
      "type": "boolean",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE03').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE04",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "First name",
      "type": "text",
      "required": true,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE03').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE05",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Middle Name",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE03').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE06",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Last name",
      "type": "text",
      "required": true,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "now()"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "EmCare.A.DE07",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Visit date",
      "type": "date",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE08",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Date of birth",
      "type": "dateTime",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "(%resource.repeat(item).where(linkId='EmCare.A.DE07').answer.value - %resource.repeat(item).where(linkId='EmCare.A.DE08').answer.value) / 365"
          }
        }
      ],
      "linkId": "AgeInMonths",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Age",
      "type": "decimal",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "system": "http://hl7.org/fhir/questionnaire-item-control",
                "code": "check-box",
                "display": "Check-box"
              }
            ],
            "text": "Check-box"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE09').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE11",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Date of Birth not known",
      "type": "boolean",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "system": "http://hl7.org/fhir/questionnaire-item-control",
                "code": "drop-down",
                "display": "Drop down"
              }
            ],
            "text": "Drop down"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE11').answer.value = true"
          }
        }
      ],
      "linkId": "EmCare.A.DE12",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Provide an estimated age or estimated date of birth",
      "type": "choice",
      "required": false,
      "answerValueSet": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/ValueSet/dob-estimator",
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE12').answer.value = \"EmCare.A.DE14\""
          }
        }
      ],
      "linkId": "EmCare.A.DE14.1",
      "text": "Only know age in weeks/days/hours",
      "type": "integer",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE12').answer.value = \"EmCare.A.DE13\""
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "iif(%resource.repeat(item).where(linkId='EmCare.A.DE08').answer.value not empty, now()-%resource.repeat(item).where(linkId='EmCare.A.DE08').answer.value, {})"
          }
        }
      ],
      "linkId": "EmCare.A.DE13.1",
      "text": "Estimated Age",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE12').answer.value = \"EmCare.A.DE15\""
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "iif(%resource.repeat(item).where(linkId='EmCare.A.DE13.1').answer.value.answer.value not empty, now()-%resource.repeat(item).where(linkId='EmCare.A.DE13.1').answer.value.answer.value, {})"
          }
        }
      ],
      "linkId": "EmCare.A.DE15.1",
      "text": "Estimated Date of Birth",
      "type": "date",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE16",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Sex",
      "type": "choice",
      "required": true,
      "answerValueSet": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/ValueSet/sex-of-the-client",
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE20",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Address",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE47",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Caregiver",
      "type": "choice",
      "required": false,
      "answerValueSet": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/ValueSet/relatedperson",
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "system": "http://hl7.org/fhir/questionnaire-item-control",
                "code": "check-box",
                "display": "Check-box"
              }
            ],
            "text": "Check-box"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value = {}"
          }
        }
      ],
      "linkId": "newCaregiver",
      "text": "Register a new caregiver",
      "type": "boolean",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE21",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Primary Caregiver First Name",
      "type": "text",
      "required": true,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE22",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Primary Caregiver Middle Name",
      "type": "text",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value = {}"
          }
        }
      ],
      "linkId": "EmCare.A.DE23",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Primary Caregiver Last Name",
      "type": "text",
      "required": true,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE35",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Caregiver's Mobile telephone number",
      "type": "string",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE36",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Caregiver's Home telephone number",
      "type": "string",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE37",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Caregiver's Work telephone number",
      "type": "string",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "linkId": "EmCare.A.DE38",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Caregiver wants to receive SMS or other messages regarding the child's visits and health status",
      "type": "boolean",
      "required": true,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "iif(%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value.answer.value not empty,%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value.answer.value, uuid())"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "emcarerelatedpersoncaregiverid",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "CommunicationRequest recipient",
      "type": "reference",
      "required": false,
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE47').answer.value = {}"
          }
        },
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-hidden",
          "valueBoolean": true
        }
      ],
      "linkId": "EmCare.A.DE24",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Primary Caregiver's Relationship to Client",
      "type": "choice",
      "required": false,
      "answerValueSet": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/ValueSet/relationship-to-client",
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "system": "http://hl7.org/fhir/questionnaire-item-control",
                "code": "drop-down",
                "display": "Drop down"
              }
            ],
            "text": "Drop down"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE24').answer.value != 'EmCare.A.DE25'"
          }
        }
      ],
      "linkId": "EmCare.A.DE31",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Biological Mother Vital Status",
      "type": "choice",
      "required": false,
      "answerValueSet": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/ValueSet/vital-status",
      "designNote": "status::draft"
    },
    {
      "extension": [
        {
          "url": "http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",
          "valueCodeableConcept": {
            "coding": [
              {
                "system": "http://hl7.org/fhir/questionnaire-item-control",
                "code": "drop-down",
                "display": "Drop down"
              }
            ],
            "text": "Drop down"
          }
        },
        {
          "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression",
          "valueExpression": {
            "language": "text/fhirpath",
            "expression": "%resource.repeat(item).where(linkId='EmCare.A.DE24').answer.value != 'EmCare.A.DE26'"
          }
        }
      ],
      "linkId": "EmCare.A.DE32",
      "definition": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes",
      "text": "Biological Father Vital Status",
      "type": "choice",
      "required": false,
      "answerValueSet": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/ValueSet/vital-status",
      "designNote": "status::draft"
    }
  ]
}